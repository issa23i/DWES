
Ejercicio 3: Tienda web con sesiones
▪ En este ejercicio hay que crear una tienda web dedicada a la venta de
productos de un determinado tipo a tu elección. Se utilizarán sesiones para
guardar la información del usuario y la BD dwes para almacenar la información
de la aplicación, accediendo a ésta mediante PDO.
▪ La primera página será login.php y servirá para autentificar al usuario, que
no podrá acceder al resto de páginas sin autentificarse antes en esta página.
▪ La siguiente página será listado_familias.php y mostrará una lista con las
familias de productos. Cada elemento de la lista será un hipervínculo con el
nombre de la familia que llevará a la página listado_productos.php pasándole
en el mismo enlace el código de la familia seleccionada.
▪ La página listado_productos.php permite añadir un producto a la cesta de la
compra. Cada producto aparecerá en una línea (nombre y precio). Se crea un
formulario por cada producto, con un botón "Añadir" que envía a esta misma
página los datos código, nombre y precio del producto.

4

Ejercicio 3: Tienda web con sesiones
▪ La página cesta.php muestra un resumen de los productos escogidos por el
usuario para su compra y da acceso a la paǵina de pago.
▪ Desde la página cesta.php se podrá ir a la paǵina logout.php o a la página
pagar.php, la cual mostrará un mensaje de tipo “Gracias por su compra” y
ofrecerá un enlace para comenzar una nueva compra.
▪ Por último, la paǵina logout.php desconecta al usuario de la sesión y lo
redirige de forma automática a la página de autentificación. No muestra
ninguna información en pantalla, por lo que no es visible para el usuario.
▪ Se utilizará la hoja de estilos tienda.css común a todas las paǵinas y una
imagen cesta.img como logo de la aplicación.
▪ Para simplificar el código, la aplicación no será completamente funcional:
▫ No se desarrolla la página con la información de pago.
▫ El usuario no podrá comprar varias unidades de un mismo producto.
▫ No se podrá retirar de la cesta un producto añadido.
▫ Se muestran todos los productos filtrados por familia en una misma
paǵina. Sería preferible mostrarlos en varias paǵinas limitando a un
número máximo los productos mostrados por paǵina.

5

Ejercicio 3: Tienda web con sesiones
▪ El fichero login.php incluye tanto el formulario HTML como el código para
procesarlo. El bloque PHP se ejecutará sólo cuando se pulse el botón “Enviar”
o, de forma equivalente, sólo cuando el método es POST.
▪ Almacena la información de los usuarios en la BD "dwes", para lo cual es
preciso crear una nueva tabla ejecutando las siguientes sentencias SQL:
USE dwes;
CREATE TABLE usuarios (
usuario VARCHAR(20) NOT NULL PRIMARY KEY,
password VARCHAR(32) NOT NULL
) ENGINE = INNODB;
INSERT INTO usuarios (usuario, password) VALUES
('dwes', 'e8dc8ccd5e5f9e3a54f07350ce8a2d3d');
▪ Las contraseñas de los usuarios no se deben almacenar en texto plano. En su
lugar se guarda el hash MD5 correspondiente. En las sentencias anteriores se
almacena el MD5 de la contraseña “abc123.” para el usuario dwes.
▪ Si las credenciales son correctas, se iniciará una nueva sesión y se
almacenará en ella el nombre del usuario que se ha conectado. Para terminar,
se reenvía al usuario a la página principal listado_familias.php.
▪ Se ha dejado un espacio para mostrar los posibles mensajes de error que se
produzcan, como la falta de algún dato o credenciales erróneas, lo cual se
debe comprobar. Si el campo de texto usuario se introdujo previamente, se
completará por defecto con el valor introducido en el envío anterior.

6

Ejercicio 3: Tienda web con sesiones
▪ El resto de páginas de la aplicación (excepto login.php y logout.php)
comprueban que sólo puedan acceder los usuarios que hayan hecho login. Para
ello, cada script se une a la sesión existente y comprueba que exista la
variable de sesión del usuario. Si no es el caso, quiere decir que el usuario
no ha hecho login correctamente y, por tanto, debe introducir usuario y
contraseña, para lo cual se le proporciona un enlace con un mensaje para que
haga clic y vaya a la paǵina de login. Otra opción sería redirigir al usuario
directamente al formulario de login pasando un parámetro en la URL para
mostrar el mensaje de error correspondiente a la redirección en la página de
login (función comprobar_sesion()).
▪ Las paǵinas que listan (familias y productos) se dividen en varias zonas:
▫ El encabezado, que contiene únicamente el título de la página.
▫ El listado de los productos o de las familias.
▫ La cesta, que muestra el código de todos los productos que se van
añadiendo a la cesta.
▫ El pie, en el que se mostrarán en la misma línea dos vínculos a dos
páginas, uno para ir a la paǵina principal (listado_familias.php) y el
otro para cerrar la sesión (logout.php) indicando el mensaje “Desconectar
usuario ” más el nombre del usuario. Del mismo modo, si ha habido algún
error se mostrará el mensaje en el pie de la página. 7

Ejercicio 3: Tienda web con sesiones
▪ El fichero listado_familias.php es la paǵina principal de la aplicación. En el
cuerpo se muestra una lista (<ul>) con las familias. Cada elemento de la lista
(<li>) es un vínculo a la paǵina listado_productos.php?familia=<cod>
▪ Los datos de todos los productos que va a comprar el usuario se guardan en una
variable de sesión. Por cada producto añadido a la cesta se guarda en la
variable de sesión el precio y el nombre (usa un array de dos elementos para
ello y el código del producto como clave para ese elemento array).
▪ En la división dedicada a la cesta se incluyen dos formularios. Uno para
vaciar la cesta (botón "Vaciar Cesta"), dirigido a la misma página, y otro
para realizar la compra (botón "Comprar"), que dirige a la página cesta.php .
Para vaciar la cesta será preciso eliminar la variable de sesión
correspondiente. Si la cesta está vacía se debe mostrar un mensaje indicándolo
y los botones para comprar o vaciar la cesta estarán deshabilitados. Si no
está vacía, se muestran los códigos de los productos que contiene.
▪ En la página listado_productos.php se mostrarán los productos cuya familia se
haya seleccionado en la página anterior. Cada producto aparecerá en una línea
(nombre y precio). Se crea un formulario por cada producto, con un botón
"Añadir" que envía a esta misma página los datos código, nombre y precio del
producto (además del código de la familia). Cuando se abre la página, se
comprueba si se ha enviado este formulario y, si fuera así, se añade un
elemento a la variable de sesión correspondiente a la cesta con los datos del
producto añadido.

8

Ejercicio 3: Tienda web con sesiones
▪ Si desde la página del listado de familias o de productos, el usuario pulsa
sobre el botón "Comprar", se le dirige a la página cesta.php, en la que se le
muestra un resumen de los productos que ha seleccionado junto al importe
total de los mismos.
▪ En la página figuran dos formularios que redirigen a otras páginas:
▫ El que contiene el botón "Pagar", que redirige a la página pagar.php, que
en este caso lo único que debe hacer es eliminar la cesta de la sesión
del usuario.
▫ El que contiene el botón de desconexión, que es similar al que figuraba
en las páginas anteriores, y dirige a la página logout.php, que cierra la
sesión del usuario y redirige a la página de login.

▪ Los datos que se necesitan en la página cesta.php se obtienen todos de la
información almacenada en la sesión del usuario. No es necesario establecer
conexión con la BD.
▪ Finalmente, se le ofrece al usuario la posibilidad de cerrar la sesión, y se
le redirige a la página de autentificación donde puede iniciar una nueva
sesión con el mismo o con otro usuario distinto. 9

Ejercicio 3: Tienda web con sesiones
▪ Modifica la aplicación de forma que añada los dos puntos siguientes:
▫ Se visualice el número de unidades del producto de forma que si el
producto que se pretende añadir a la cesta, ya existe en la cesta, se
incremente y visualice a su derecha el número de unidades. Así, en la
cesta se visualizará, el nombre del producto y el número de unidades
seleccionadas.
▫ Al pulsar el botón Comprar se visualice una única vez cada producto
indicando el número de unidades, el carácter 'x' y el precio

--------------

uno -- los hipervínculos a la familia seleccionad con get
    -- en el listado_familias.php se recoge con request
    -- conslta
 -- LOS DATOS DEL PRODUCTO CON SESSION EN LA MISMA PÁGINA
       (PASANDO LA FAMILIA OCULTA EN EL BOTÓN AÑADIR)
$producto = ['nombre' =>    , 'pvp' =>    , unidades , familia ];
$cod_prod = POST['cod_prod']; 
$_SESSIONP['cesta][$cod_prod] = $producto

$_post['nombre']  $_post['pvp']
$cesta = $_session['cesta'];

if(key_exist($cod_prod , $cesta)){
    $_session['cesta'][$cod_prod]['unidades']++;
}
// actualizar la sesion
$_session['cesta'] = $cesta
  


comprobar si ya está el producto en la cesta (if(key_exists($cod_prod,
    -- un formulario por cada prodcuto
    -- ( no hace falta de momento controlar el stock, osea restar de la bbdd)
    -- se añaden a $session (cesta) array con cod, nombre y unidades
    -- un enlace por si quieren volver atrás
    -- si pagina siguietne (cesta.php - boton comprar) la info  está en la session
    --- pagar borra session y vuelve a tienda (index.php)